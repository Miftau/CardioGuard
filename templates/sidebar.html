<!-- templates/_sidebar.html -->
<div class="sidebar d-flex flex-column p-3 bg-light border-end vh-100 position-fixed" style="width: 250px;">
    <!-- Notifications & Messages Icons 
    <div class="d-flex justify-content-between mb-4">
        <!-- Notifications -->
        <div class="relative flex-grow-1 me-2" id="notification-bell">
            <a href="#" class="text-gray-700 hover:text-red-500 text-xl d-block text-center" onclick="toggleDropdown('notif-dropdown'); return false;">
                <i class="fas fa-bell"></i>
                <span id="notification-count-badge" class="absolute -top-1 -end-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center hidden">0</span>
            </a>
            <div id="notif-dropdown" class="absolute end-0 mt-2 w-64 bg-white dark:bg-gray-800 shadow-lg rounded-lg hidden z-50">
                <div class="p-2 text-sm text-gray-700 dark:text-gray-300" id="notification-list">
                    Loading...
                </div>
            </div>
        </div>

        <!-- Messages -->
        <div class="relative flex-grow-1 ms-2" id="message-envelope">
            <a href="{{ url_for('messages_page') }}" class="text-gray-700 hover:text-red-500 text-xl d-block text-center">
                <i class="fas fa-envelope"></i>
                <span id="message-count-badge" class="absolute -top-1 -end-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center hidden">0</span>
            </a>
        </div>
    </div>

    <h5 class="mb-4">Settings</h5>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('user_dashboard') }}">
                <i class="bi bi-speedometer2"></i> Dashboard
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('edit_profile') }}">
                <i class="bi bi-person"></i> Edit Profile
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('pricing') }}">
                <i class="bi bi-credit-card"></i> Subscription
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('my_bookings') }}">
                <i class="bi bi-calendar-check"></i> My Bookings
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('messages_page') }}"> <!-- Link also exists above -->
                <i class="bi bi-envelope"></i> Messages
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('form') }}">
                <i class="bi bi-file-medical"></i> Health Prediction
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('chat') }}">
                <i class="bi bi-robot"></i> AI Consultation
            </a>
        </li>
        <!-- Add more links as needed: Notification Settings, Privacy, etc. -->
        <li class="nav-item mt-auto">
            <a class="nav-link text-danger" href="#" onclick="confirmDelete()">
                <i class="bi bi-trash"></i> Delete Account
            </a>
        </li>
    </ul>
</div>

<script>
 function confirmDelete() {
     if (confirm("Are you sure you want to delete your account permanently? This action cannot be undone.")) {
         // Submit a POST request to the delete endpoint
         fetch('/user/account/delete', {
             method: 'POST',
             credentials: 'same-origin', // Include session cookies
             headers: {
                 'Content-Type': 'application/json',
                 // Include CSRF token if you use one
                 // 'X-CSRFToken': getCookie('csrftoken') // Example CSRF token
             },
         })
         .then(response => {
             if (response.ok) {
                 // Redirect to index or login after successful deletion
                 window.location.href = "{{ url_for('index') }}";
             } else {
                 alert("Failed to delete account. Please try again.");
             }
         })
         .catch(error => {
             console.error('Error:', error);
             alert("An error occurred. Please try again.");
         });
     }
 }
 // Helper function to get CSRF token from cookie (if applicable)
 // function getCookie(name) { ... }
</script>